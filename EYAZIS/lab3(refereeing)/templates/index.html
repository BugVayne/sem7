{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –°–∏—Å—Ç–µ–º–∞ —Ä–µ—Ñ–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="text-center mb-5">
            <h1 class="display-4 mb-3">üìÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ—Ñ–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h1>
            <p class="lead text-muted">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –∏ –ø–æ–ª—É—á–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞—Ç</p>
        </div>

        <!-- –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div class="card shadow-lg border-0">
            <div class="card-header bg-primary text-white py-3">
                <h4 class="mb-0"><i class="bi bi-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞</h4>
            </div>
            <div class="card-body p-4">
                <form id="uploadForm" action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data">
                    <div class="mb-4">
                        <div id="uploadArea" class="upload-area">
                            <i class="bi bi-cloud-upload feature-icon text-primary"></i>
                            <h5>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</h5>
                            <p class="text-muted mb-3">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: TXT (–º–∞–∫—Å–∏–º—É–º 16MB)</p>
                            <input type="file" name="file" id="fileInput" accept=".txt" style="display: none;">
                            <button type="button" class="btn btn-primary btn-lg" onclick="document.getElementById('fileInput').click()">
                                <i class="bi bi-folder2-open me-2"></i>–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                            </button>
                        </div>
                        <div id="fileInfo" class="alert alert-info mt-3" style="display: none;">
                            <i class="bi bi-file-text me-2"></i><strong>–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª:</strong> <span id="fileName"></span>
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-success btn-lg py-3" id="submitBtn" disabled>
                            <i class="bi bi-gear me-2"></i>
                            <span class="submit-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å</span>
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ -->
        <div class="row mt-5">
            <div class="col-md-3 text-center mb-4">
                <div class="feature-icon text-primary">
                    <i class="bi bi-translate"></i>
                </div>
                <h5>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–∑—ã–∫–æ–≤</h5>
                <p class="text-muted">–†—É—Å—Å–∫–∏–π –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫–∏</p>
            </div>
            <div class="col-md-3 text-center mb-4">
                <div class="feature-icon text-primary">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
                <h5>–¢–µ–∫—Å—Ç–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h5>
                <p class="text-muted">–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞</p>
            </div>
            <div class="col-md-3 text-center mb-4">
                <div class="feature-icon text-primary">
                    <i class="bi bi-download"></i>
                </div>
                <h5>–≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h5>
                <p class="text-muted">TXT –∏ PDF —Ñ–æ—Ä–º–∞—Ç—ã</p>
            </div>
            <div class="col-md-3 text-center mb-4">
                <div class="feature-icon text-primary">
                    <i class="bi bi-clock-history"></i>
                </div>
                <h5>–ò—Å—Ç–æ—Ä–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏</h5>
                <p class="text-muted">–î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const submitBtn = document.getElementById('submitBtn');
    const form = document.getElementById('uploadForm');

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è drag & drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
        uploadArea.classList.add('dragover');
    }

    function unhighlight() {
        uploadArea.classList.remove('dragover');
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ dropped —Ñ–∞–π–ª–æ–≤
    uploadArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    fileInput.addEventListener('change', function() {
        handleFiles(this.files);
    });

    function handleFiles(files) {
        if (files.length > 0) {
            const file = files[0];
            if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                fileName.textContent = file.name + ' (' + (file.size / 1024).toFixed(2) + ' KB)';
                fileInfo.style.display = 'block';
                submitBtn.disabled = false;
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ TXT —Ñ–∞–π–ª');
            }
        }
    }

    // –ü–æ–∫–∞–∑ —Å–ø–∏–Ω–Ω–µ—Ä–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', function() {
        submitBtn.disabled = true;
        submitBtn.querySelector('.spinner-border').style.display = 'inline-block';
        submitBtn.querySelector('.submit-text').textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
    });
</script>
{% endblock %}