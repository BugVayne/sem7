<!-- templates/result.html (–û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø) -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ—Ñ–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .summary-card {
            border-left: 4px solid #0d6efd;
        }
        .keyword-badge {
            margin: 2px;
            font-size: 0.9em;
        }
        .text-preview {
            max-height: 200px;
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }
        .full-text-modal {
            max-height: 80vh;
        }
        .full-text-content {
            max-height: 60vh;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }
        @media print {
            .no-print {
                display: none !important;
            }
            .card {
                border: 1px solid #000 !important;
            }
            .summary-card {
                border-left: 4px solid #000 !important;
            }
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ—Ñ–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è</h1>
                    <div class="no-print">
                        {% if from_history %}
                            <a href="{{ url_for('history_page') }}" class="btn btn-outline-primary">
                                ‚Üê –ö –∏—Å—Ç–æ—Ä–∏–∏
                            </a>
                        {% else %}
                            <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                                üìÑ –ù–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
                            </a>
                        {% endif %}
                    </div>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ</h5>
                        <div class="no-print">
                            <button class="btn btn-sm btn-outline-secondary" onclick="window.print()">
                                üñ®Ô∏è –ü–µ—á–∞—Ç—å
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <strong>–§–∞–π–ª:</strong> {{ result.filename }}
                            </div>
                            <div class="col-md-3">
                                <strong>–†–∞–∑–º–µ—Ä:</strong> {{ "%.2f"|format(result.file_size / 1024) }} KB
                            </div>
                            <div class="col-md-3">
                                <strong>–Ø–∑—ã–∫:</strong>
                                {% if result.language == 'ru' %}–†—É—Å—Å–∫–∏–π{% else %}–ê–Ω–≥–ª–∏–π—Å–∫–∏–π{% endif %}
                            </div>
                            <div class="col-md-3">
                                <strong>–°–∂–∞—Ç–∏–µ:</strong> {{ result.compression_ratio }}%
                            </div>
                        </div>
                        {% if result.upload_time %}
                        <div class="row mt-2">
                            <div class="col-12">
                                <strong>–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:</strong> {{ result.upload_time }}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç (–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä)</h5>
                        <div class="no-print">
                            <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#fullTextModal">
                                üìñ –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="text-preview">
                            {{ result.original_text_preview }}
                        </div>
                        {% if result.original_length > 500 %}
                        <div class="mt-2 text-muted">
                            <small>–ü–æ–∫–∞–∑–∞–Ω–æ 500 –∏–∑ {{ result.original_length }} —Å–∏–º–≤–æ–ª–æ–≤</small>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ–µ—Ä–∞—Ç -->
                <div class="card mb-4 summary-card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">üìù –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ–µ—Ä–∞—Ç</h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">{{ result.classic_summary }}</p>
                        <div class="mt-3 text-muted">
                            <small>–î–ª–∏–Ω–∞ —Ä–µ—Ñ–µ—Ä–∞—Ç–∞: {{ result.summary_length }} —Å–∏–º–≤–æ–ª–æ–≤</small>
                        </div>
                    </div>
                </div>

                <!-- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">üîë –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</h5>
                    </div>
                    <div class="card-body">
                        {% for keyword in result.keyword_summary %}
                            <span class="badge bg-primary keyword-badge">{{ keyword }}</span>
                        {% endfor %}
                    </div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è -->
                <div class="card no-print">
                    <div class="card-header">
                        <h5 class="mb-0">üíæ –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h5>
                    </div>
                    <div class="card-body">
                        <div class="btn-group" role="group">
                            <a href="{{ url_for('download_summary', format_type='txt', classic_summary=result.classic_summary, keywords=result.keyword_summary, text_id=result.text_id) }}"
                               class="btn btn-outline-success">
                                üìÑ –°–∫–∞—á–∞—Ç—å –∫–∞–∫ TXT
                            </a>
                            <a href="{{ url_for('download_summary', format_type='pdf', classic_summary=result.classic_summary, keywords=result.keyword_summary, text_id=result.text_id) }}"
                               class="btn btn-outline-danger">
                                üìä –°–∫–∞—á–∞—Ç—å –∫–∞–∫ PDF
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ -->
    <div class="modal fade" id="fullTextModal" tabindex="-1" aria-labelledby="fullTextModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content full-text-modal">
                <div class="modal-header">
                    <h5 class="modal-title" id="fullTextModalLabel">–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç: {{ result.filename }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="full-text-content" id="fullTextContent">
                        –ó–∞–≥—Ä—É–∑–∫–∞...
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="printFullText()">üñ®Ô∏è –ü–µ—á–∞—Ç—å —Ç–µ–∫—Å—Ç–∞</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.getElementById('fullTextModal').addEventListener('show.bs.modal', function () {
            const textId = "{{ result.text_id }}";
            if (textId) {
                fetch(`/get_full_text/${textId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            document.getElementById('fullTextContent').textContent = data.text;
                        } else {
                            document.getElementById('fullTextContent').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç–∞';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('fullTextContent').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç–∞';
                    });
            }
        });

        function printFullText() {
            const textContent = document.getElementById('fullTextContent').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç: {{ result.filename }}</title>
                        <style>
                            body {
                                font-family: 'Courier New', monospace;
                                line-height: 1.6;
                                white-space: pre-wrap;
                                padding: 20px;
                                max-width: 1000px;
                                margin: 0 auto;
                            }
                            .header {
                                text-align: center;
                                margin-bottom: 20px;
                                border-bottom: 2px solid #000;
                                padding-bottom: 10px;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h2>–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞</h2>
                            <h3>{{ result.filename }}</h3>
                            <p>–î–ª–∏–Ω–∞: {{ result.original_length }} —Å–∏–º–≤–æ–ª–æ–≤</p>
                        </div>
                        <div>${textContent}</div>
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
        }
    </script>
</body>
</html>